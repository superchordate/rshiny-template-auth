<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A demo showcasing the integration of R Shiny with Tailwind CSS, demonstrating modern web development practices in R.">
    <title>{{ app_title }}</title>    
    {{ headContent() }}
    {{ import_www() }}

    <!-- firebase/identity provider initialization and persistence -->
    <!-- https://console.cloud.google.com/customer-identity/providers > select provider > click APPLICATION SETUP DETAILS -->
    <script src="https://www.gstatic.com/firebasejs/8.0/firebase.js"></script>

    <!-- firebase UI https://firebase.google.com/docs/auth/web/firebaseui -->
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />

  </head>

  <!-- the user will see any hard-coded HTML below. you can use it to set up your logged-out UI -->
  <body style="background-color: #E3A4A5;">

    <!-- Firebase login UI -->
    <div class="hidden">{{ textInput(inputId="idToken", label="", value=NULL) }}</div>
    {{ uiOutput("login") }}

    <!-- the "protected" output hides app content behind the authorization flow. -->
    {{ uiOutput("protected") }}

  </body>

  <script>

    var config = {
      apiKey: "{{ firebase_config$apiKey }}",
      authDomain: "{{ firebase_config$authDomain }}",
    };

    firebase.initializeApp(config);
    var auth = firebase.auth();

    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => {
        auth.onAuthStateChanged((user) => {
          if (user) {
            user.getIdToken().then(function (idToken) {
              Shiny.setInputValue("idToken", idToken);
            });
          } else {
            Shiny.setInputValue("idToken", "logout");
        }})

      })

  </script>
  
</html>